# overwrite the default version scheme - we have our own set in MsBuild
version: '{build}'

image: Visual Studio 2017

cache:
  - packages -> **\packages.config
  - 'Acoustics\Acoustics.Test\TestResources'

matrix:
  fast_finish: true
  
platform:
  - Any CPU

configuration:
  - Debug
  - Release

# Restore packages
before_build:
  - cd AudioAnalysis
  - nuget restore

build_script:
  - ps: >
      msbuild 
      "C:\projects\audio-analysis\AudioAnalysis\AudioAnalysis2012.sln" /m /verbosity:minimal 
      /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"
      /p:WarningLevel=0 /p:RunCodeAnalysis=false /t:AnalysisPrograms
      /p:Configuration=$env:configuration /property:Platform=$env:platform

test:
  assemblies:
    only:
      #- "C:\Work\Github\audio-analysis\Acoustics\Acoustics.Test\bin\Debug\Acoustics.Test.dll"
      #- "C:\Work\Github\audio-analysis\AudioAnalysis\Analysis.Test\bin\Debug\Acoustics.Test.dll"
      #- "C:\Work\Github\audio-analysis\AudioAnalysis\AED\Test\bin\Debug\Test.dll"
      - "Acoustics\\Acoustics.Test\\bin\\$(configuration)\\Acoustics.Test.dll"
      - "AudioAnalysis\\Analysis.Test\\bin\\$(configuration)\\Acoustics.Test.dll"

init:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
on_finish:
  - ps: $blockRdp = $true;
